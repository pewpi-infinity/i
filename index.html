<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Octave OS — Infinity Terminal (Logger)</title>
  <style>
    /* colour scheme like the original: dark teal terminal + light page */
    body { font-family: system-ui, -apple-system, Roboto, "Helvetica Neue", Arial; background:#e9f1f5; color:#08303b; padding:20px; }
    .terminal { background:#0b3b4a; color:#7be6ff; padding:18px; border-radius:10px; max-width:820px; margin: 0 auto 18px; font-family: monospace; }
    .card { background:#ffffff; max-width:820px; margin: 0 auto; padding:18px; border-radius:10px; box-shadow: 0 6px 18px rgba(8,48,59,0.06); }
    h1 { margin:0 0 8px 0; font-size:20px; color:#08303b; }
    label { color:#08303b; font-weight:600; display:block; margin-bottom:6px; }
    textarea { width:100%; height:140px; font-size:14px; padding:10px; box-sizing:border-box; border:1px solid #d6e2e6; border-radius:6px; resize:vertical; }
    .controls { margin-top:12px; display:flex; gap:8px; align-items:center; }
    button { padding:8px 12px; border-radius:6px; border:1px solid #bfcfd3; background:#f6f8f9; cursor:pointer; }
    #status { display:block; margin-top:12px; min-height:20px; color:#b00020; font-weight:600; }
    .small { font-size:13px; color:#667a80; margin-top:10px; }
    input.encoded { padding:8px; border-radius:6px; border:1px solid #d6e2e6; width:100%; box-sizing:border-box; }
    @media (max-width:560px){ .terminal,.card{padding:12px} input.encoded{width:100%} }
  </style>
</head>
<body>
  <div class="terminal">
    Octave OS v0.12 — Frontend logger ready.
    <div style="margin-top:8px; color:#baf2ff;">Choose a logging method and press Enter.</div>
  </div>

  <div class="card">
    <h1>Frontend logger</h1>

    <label for="log-input">Type conversation text to record:</label>
    <textarea id="log-input" placeholder="Type message to append to logs/txt.log..."></textarea>

    <div style="margin-top:10px;">
      <label for="encoded-token" style="font-size:13px; font-weight:600;">Encoded GitHub token (paste only an already‑encoded token)</label>
      <input id="encoded-token" class="encoded" type="text" placeholder="Paste encoded token here (BASE64) — do NOT paste raw PAT" />
      <div class="small">Important: Do NOT paste your raw GitHub PAT here. Generate an encoded token locally (use the encoder script) and paste the encoded value. This page will not encode secrets for you.</div>
    </div>

    <div style="margin-top:10px;">
      <label for="secret-input" style="font-size:13px; font-weight:600;">Commit secret (paste only for this session)</label>
      <input id="secret-input" class="encoded" type="password" placeholder="Paste COMMIT_SECRET for this session" />
    </div>

    <div class="controls">
      <button id="send-btn">Send to log</button>
      <button id="clear-btn">Clear</button>
      <span id="status" aria-live="polite"></span>
    </div>

    <p class="small">Note: The frontend will POST typed text to your local commit server. The server must be running and must read GITHUB_TOKEN_B64 from server/.env (locally). Do not put raw PATs in this page or commit them to the repo.</p>
  </div>

  <script>
    // This page never encodes a raw PAT. It expects a base64-encoded token (GITHUB_TOKEN_B64).
    async function postCommit(text, encodedToken, secret) {
      // This function will call the local server. Server should be configured to decode GITHUB_TOKEN_B64 from server/.env.
      // We do NOT send raw tokens here. If you choose to test by sending encoded token to the server,
      // keep in mind the server must be local and protected; preferred workflow: place encoded token in server/.env.
      const headers = { 'Content-Type': 'application/json' };
      if (secret) headers['X-Commit-Secret'] = secret;
      // NOTE: Sending encoded token over network is optional — preferred: put the encoded token in server/.env.
      if (encodedToken) headers['X-GITHUB-TOKEN-B64'] = encodedToken;

      const resp = await fetch('/commit', {
        method: 'POST',
        headers,
        credentials: 'same-origin',
        body: JSON.stringify({ text })
      });
      return resp;
    }

    document.addEventListener('DOMContentLoaded', function() {
      const input = document.getElementById('log-input');
      const encodedInput = document.getElementById('encoded-token');
      const secretInput = document.getElementById('secret-input');
      const sendBtn = document.getElementById('send-btn');
      const clearBtn = document.getElementById('clear-btn');
      const status = document.getElementById('status');

      function setStatus(msg, isError) {
        status.textContent = msg;
        status.style.color = isError ? '#b00020' : '#0a6f2b';
      }

      sendBtn.addEventListener('click', async function() {
        setStatus('', false);
        const text = input.value || '';
        const encoded = encodedInput.value || '';
        const secret = secretInput.value || '';
        if (!text.trim()) { setStatus('Type something to send', true); return; }
        if (!secret.trim()) { setStatus('Paste COMMIT_SECRET (session only) before sending', true); return; }

        try {
          setStatus('Sending...', false);
          const r = await postCommit(text, encoded, secret);
          const body = await r.json().catch(()=>({}));
          if (!r.ok) { setStatus('Error: ' + (body.error || r.status), true); return; }
          setStatus('Logged — commit: ' + (body.commit || '(unknown)'), false);
          input.value = '';
        } catch (err) {
          console.error(err);
          setStatus('Network error: ' + (err.message || err), true);
        }
      });

      clearBtn.addEventListener('click', function() { input.value = ''; setStatus('', false); });
    });
  </script>
</body>
</html>