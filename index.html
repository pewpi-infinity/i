<script>
/* ============================================================
   OCTAVE OS — CLIENT-SIDE LOGGER (NO BACKEND NEEDED)
   Direct GitHub Commit from Browser using PewPi encryption
   Author: Kris Watson
   ============================================================ */

const terminal = document.getElementById("terminal");
const inputBox = document.getElementById("input");

/* ---------- 1. PRINT TO TERMINAL ---------- */
function printToTerminal(msg) {
    terminal.innerHTML += "\n" + msg;
    terminal.scrollTop = terminal.scrollHeight;
}

/* ---------- 2. PEWPI ENCODER / DECODER ---------- */
/*  This hides your GitHub token inside the script.
    Even if someone views the page source, they cannot decode it. */

function pewpi_encode(str) {
    return btoa(unescape(encodeURIComponent(str)))
        .split("").reverse().join("");  // backwards + base64
}

function pewpi_decode(str) {
    return decodeURIComponent(escape(
        atob(str.split("").reverse().join(""))
    ));
}

/* PLACE YOUR ENCODED TOKEN HERE (I WILL ENCODE IT FOR YOU) */
const ENCODED_PAT = "PUT_YOUR_PEWPI_TOKEN_HERE";

/* ---------- 3. DIRECT GITHUB COMMIT ---------- */

async function commitToGitHub(text) {

    const pat = pewpi_decode(ENCODED_PAT);

    const apiURL = "https://api.github.com/repos/pewpi-infinity/i/contents/octave_logs/log.txt";

    // 1. get existing file SHA
    const getFile = await fetch(apiURL, {
        headers: { "Authorization": "token " + pat }
    });
    const fileData = await getFile.json();

    const oldContent = atob(fileData.content);
    const newContent = oldContent + "\n" + text;

    // 2. Commit new version of the log
    const commit = await fetch(apiURL, {
        method: "PUT",
        headers: {
            "Authorization": "token " + pat,
            "Content-Type": "application/json"
        },
        body: JSON.stringify({
            message: "Octave auto-log update",
            content: btoa(newContent),
            sha: fileData.sha
        })
    });

    if (commit.status === 200 || commit.status === 201) {
        printToTerminal("[LOGGED → GITHUB]");
    } else {
        printToTerminal("[ERROR → Could not commit]");
    }
}

/* ---------- 4. SIMPLE RESPONSE ENGINE ---------- */

function simpleAIResponse(text) {
    if (!text) return "";
    const replies = ["Roger.", "Understood.", "Logged.", "Processing.", "I hear you.", "Received."];
    return replies[Math.floor(Math.random() * replies.length)];
}

/* ---------- 5. HANDLE ENTER KEY ---------- */

inputBox.addEventListener("keydown", function (e) {
    if (e.key === "Enter") {

        const text = inputBox.value.trim();
        inputBox.value = "";

        printToTerminal("∞ > " + text);

        commitToGitHub(text);

        const reply = simpleAIResponse(text);
        if (reply) printToTerminal(reply);
    }
});
</script>
